<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Transactions - SMART Verifiable IPS for Pilgrimage v2.0.3</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>
    <link href="assets/css/fa-all.css" rel="stylesheet" type="text/css" />
    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
    <link href="assets/css/who.css" rel="stylesheet"/>
    <link href="assets/css/lforms.min.css" rel="stylesheet"/>


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="fhir-logo" sizes="144x144" href="assets/ico/icon-fhir-144.png"/>
    <link rel="fhir-logo" sizes="114x114" href="assets/ico/icon-fhir-114.png"/>
    <link rel="fhir-logo" sizes="72x72" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"3.3"}
    h3,h4,h5,h6{--heading-prefix:"3.3"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->

      <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
        <div id="stripe"> </div>
        <div class="container">  <!-- container -->
          <!-- HEADER CONTENT -->
  
          <nav class="navbar navbar-inverse">
            <!--status-bar-->
            <div class="container">
              <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
                <span class="icon-bar"> </span>
                <span class="icon-bar"> </span>
                <span class="icon-bar"> </span>
              </button>
              <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
              <div class="nav-collapse collapse navbar-inverse-collapse">
                <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Home
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="index.html">Summary</a>
      </li>
      <li>
        <a href="changes.html">Changes</a>
      </li>
      <li>
        <a href="dependencies.html">Dependencies</a>
      </li>
      <li>
        <a href="references.html">References</a>
      </li>
      <li>
        <a href="adapting.html">Adapting Guidelines for Country use</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Business Requirements
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="concepts.html">Concepts</a>
      </li>
      <li>
        <a href="personas.html">Generic Personas</a>
      </li>
      <li>
        <a href="scenarios.html">User Scenarios</a>
      </li>
      <li>
        <a href="business-processes.html">Business Processes</a>
      </li>
      <li>
        <a href="dictionary.html">Data Dictionary</a>
      </li>
      <li>
        <a href="decision-logic.html">Decision-support Logic</a>
      </li>
      <li>
        <a href="indicators.html">Indicator and Performance Metrics</a>
      </li>
      <li>
        <a href="functional-requirements.html">Functional Requirements</a>
      </li>
      <li>
        <a href="non-functional-requirements.html">Non-functional Requirements</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Data Models and Exchange
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="system-actors.html">System Actors</a>
      </li>
      <li>
        <a href="sequence-diagrams.html">Sequence Diagrams</a>
      </li>
      <li>
        <a href="transactions.html">Transactions</a>
      </li>
      <li>
        <a href="indicators-measures.html">Indicators and Measures</a>
      </li>
      <li>
        <a href="codings.html">Codings</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Deployment
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="security-privacy.html">Security and Privacy Considerations</a>
      </li>
      <li>
        <a href="testing.html">Testing</a>
      </li>
      <li>
        <a href="test-data.html">Test Data</a>
      </li>
      <li>
        <a href="reference-implementations.html">Reference Implementations</a>
      </li>
      <li>
        <a href="trust_domain.html">Trust Domains</a>
      </li>
      <li>
        <a href="downloads.html">Downloads</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Indices
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="artifacts.html">Artifact Index</a>
      </li>
      <li>
        <a href="maps.html">Mappings</a>
      </li>
    </ul>
  </li>
</ul>
              </div>  <!-- /.nav-collapse -->

              <div class="sf_colsIn col-md-8  navbar-right-container" data-sf-element="LanguageSelectorSearch" data-placeholder-label="Language Selector and Search" style="display: flex; justify-content: flex-end; align-items: center;">
                <!-- This div will be pushed to the right -->
                <div class="language-selector" style="margin-left: auto; background-color: #00477d; color: white;">
                  <i class="fa fa-language fa-lg"></i>
                  <label for="language-selector"> </label>
                  <select onChange="openLink(value)" id="language-selector" name="language-selector">
                    <option disabled selected>Select language</option>
                    <option value="en" class="selected">English</option>
                  </select>
                  <i class="fas fa-angle-down"></i>
                </div>
                <!-- Search Content -->
              </div>
            </div>  <!-- /.container -->
          </nav>  <!-- /.navbar -->
        <!-- /HEADER CONTENT -->
        </div>  <!-- /container -->
      </div>  <!-- /segment-navbar -->
      

      <div class="container" style=" justify-content: space-between; align-items: left;">

        <!-- Placeholder for child template header declarations -->
<div id="project-nav">
    <a id="who-logo" no-external="true" href="index.html">
      
<img height="50" style="margin:7px" alt="Welcome on standards website" src="assets/images/h-logo-blue.svg"/>
        
    </a>
</div>

 <div id="family-nav">
  <a id="fhir-logo" no-external="true" href="http://hl7.org/fhir">  </a>
</div> 


        <div id="ig-status" class="ig-status-active">
          <p><span style="font-size:12pt;font-weight:bold">SMART Verifiable IPS for Pilgrimage</span>
            <br/>
            <span style="display:inline-block;">2.0.3 - release


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->


    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><a href='data-models-and-exchange.html'><b>Data Models and Exchange</b></a></li><li><b>Transactions</b></li>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">This page is part of the SMART Verifiable IPS for Pilgrimage (v2.0.3: Release) based on <a data-no-external="true" href="http://hl7.org/fhir/R4">FHIR (HL7® FHIR® Standard) R4</a>. This is the current published version in its permanent home (it will always be available at this URL).  For a full list of available versions, see the <a data-no-external="true" href="http://smart.who.int/ips-pilgrimage/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>Transactions</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#record-consent-request" id="markdown-toc-record-consent-request">record consent from wallet - request</a></li>
  <li><a href="#issue-vhl-request" id="markdown-toc-issue-vhl-request">issue VHL - request</a></li>
  <li><a href="#retrieve-VHL-manifest-request" id="markdown-toc-retrieve-VHL-manifest-request">retrieve VHL folder docs - request</a></li>
  <li><a href="#retrieve-IPS-request" id="markdown-toc-retrieve-IPS-request">retrieve IPS - request</a></li>
</ul>

</div>
<p>These are the transactions defined for ips-pilgrimage</p>

<h3 id="record-consent-request">record consent from wallet - request</h3>

<p>The Record Consent Request Event transaction is initiated by a Origin Country Health Solution against the Origin Country HIE. This transaction shall follow the IHE PCF record consent (ITI-108) transaction. The Origin Country Health Wallet acts as the Consent Record actor role and the Origin Country HIE acts as the Consent Registry actor role.</p>

<figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="224px" preserveAspectRatio="none" style="width:508px;height:224px;" version="1.1" viewBox="0 0 508 224" width="508px" zoomAndPan="magnify"><defs /><g><g><title>Origin Country</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="59.1909" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="52.5938" y2="172.9922" /></g><g><title>Origin Country</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="306.9595" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="310.7686" x2="310.7686" y1="52.5938" y2="172.9922" /></g><g class="participant participant-head" data-participant="HW"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="5" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="12" y="24.9951">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="94.7256" x="15.8281" y="41.292">Health Wallet</text></g><g class="participant participant-tail" data-participant="HW"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="5" y="171.9922" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="12" y="191.9873">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="94.7256" x="15.8281" y="208.2842">Health Wallet</text></g><g class="participant participant-head" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="252.7686" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="259.7686" y="24.9951">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="299.2085" y="41.292">HIE</text></g><g class="participant participant-tail" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="252.7686" y="171.9922" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="259.7686" y="191.9873">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="299.2085" y="208.2842">HIE</text></g><g class="message" data-participant-1="HW" data-participant-2="OCHIE"><polygon fill="#107050" points="298.9595,79.7266,308.9595,83.7266,298.9595,87.7266,302.9595,83.7266" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="63.1909" x2="304.9595" y1="83.7266" y2="83.7266" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="70.1909" y="78.6606">01:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="186.8496" x="97.4805" y="78.6606">send consent record request</text></g><g class="message" data-participant-1="OCHIE" data-participant-2="OCHIE"><line style="stroke:#107050;stroke-width:1;" x1="310.9595" x2="352.9595" y1="112.8594" y2="112.8594" /><line style="stroke:#107050;stroke-width:1;" x1="352.9595" x2="352.9595" y1="112.8594" y2="125.8594" /><line style="stroke:#107050;stroke-width:1;" x1="311.9595" x2="352.9595" y1="125.8594" y2="125.8594" /><polygon fill="#107050" points="321.9595,121.8594,311.9595,125.8594,321.9595,129.8594,317.9595,125.8594" style="stroke:#107050;stroke-width:1;" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="317.9595" y="107.7935">02:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="156.4063" x="345.249" y="107.7935">store consent directives</text></g><g class="message" data-participant-1="OCHIE" data-participant-2="HW"><polygon fill="#107050" points="74.1909,150.9922,64.1909,154.9922,74.1909,158.9922,70.1909,154.9922" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="68.1909" x2="309.9595" y1="154.9922" y2="154.9922" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="80.1909" y="149.9263">03:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="196.479" x="107.4805" y="149.9263">send consent record response</text></g></g></svg>
</figure>

<h4 id="trigger-events">Trigger Events</h4>
<ul>
  <li>A new consent directive has been recorded by a <a href="system-actors.html#ochw">Digital Health Wallet</a>.</li>
</ul>

<h4 id="message-semantics">Message Semantics</h4>

<h5 id="message-semantics-request">Message Semantics Request</h5>
<ul>
  <li>
    <p>The message semantics for Record Consent Request utilizes a FHIR Consent resource set as PUT or POST http request.</p>
  </li>
  <li>
    <p>See <a href="https://profiles.ihe.net/ITI/PCF/ITI-108.html">https://profiles.ihe.net/ITI/PCF/ITI-108.html</a> for more details.</p>
  </li>
  <li>
    <p>Specifically,</p>
    <ul>
      <li>Access Consent - Create (ITI-108)</li>
      <li>Access Consent - Update (ITI-108)</li>
    </ul>
  </li>
</ul>

<h5 id="message-semantics-response">Message Semantics Response</h5>
<ul>
  <li>See the ITI 108 for Create and Update sections. The success or failure of the create/ update interaction is indicated by the http response code (e.g., 400, 200, etc.).</li>
</ul>

<h4 id="expected-actions">Expected Actions</h4>
<ul>
  <li>The consent is stored in the consent registry. Please see here for Capability statements for the <a href="https://profiles.ihe.net/ITI/PCF/CapabilityStatement-IHE.PCF.consentRegistry.html">Consent Registry actor</a></li>
</ul>

<h3 id="issue-vhl-request">issue VHL - request</h3>

<p>The issue VHL Request Event transaction is initiated by a Origin Country Health Wallet against the Origin Country HIE.</p>

<figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="224px" preserveAspectRatio="none" style="width:553px;height:224px;" version="1.1" viewBox="0 0 553 224" width="553px" zoomAndPan="magnify"><defs /><g><g><title>Origin Country</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="59.1909" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="52.5938" y2="172.9922" /></g><g><title>Origin Country</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="272.7773" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="276.5864" x2="276.5864" y1="52.5938" y2="172.9922" /></g><g class="participant participant-head" data-participant="HW"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="5" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="12" y="24.9951">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="94.7256" x="15.8281" y="41.292">Health Wallet</text></g><g class="participant participant-tail" data-participant="HW"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="5" y="171.9922" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="12" y="191.9873">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="94.7256" x="15.8281" y="208.2842">Health Wallet</text></g><g class="participant participant-head" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="218.5864" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="225.5864" y="24.9951">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="265.0264" y="41.292">HIE</text></g><g class="participant participant-tail" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="218.5864" y="171.9922" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="225.5864" y="191.9873">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="265.0264" y="208.2842">HIE</text></g><g class="message" data-participant-1="HW" data-participant-2="OCHIE"><polygon fill="#107050" points="264.7773,79.7266,274.7773,83.7266,264.7773,87.7266,268.7773,83.7266" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="63.1909" x2="270.7773" y1="83.7266" y2="83.7266" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="70.1909" y="78.6606">01:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="152.6675" x="97.4805" y="78.6606">send issue VHL request</text></g><g class="message" data-participant-1="OCHIE" data-participant-2="OCHIE"><line style="stroke:#107050;stroke-width:1;" x1="276.7773" x2="318.7773" y1="112.8594" y2="112.8594" /><line style="stroke:#107050;stroke-width:1;" x1="318.7773" x2="318.7773" y1="112.8594" y2="125.8594" /><line style="stroke:#107050;stroke-width:1;" x1="277.7773" x2="318.7773" y1="125.8594" y2="125.8594" /><polygon fill="#107050" points="287.7773,121.8594,277.7773,125.8594,287.7773,129.8594,283.7773,125.8594" style="stroke:#107050;stroke-width:1;" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="283.7773" y="107.7935">02:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="235.0664" x="311.0669" y="107.7935">generate HCERT containing the VHL</text></g><g class="message" data-participant-1="OCHIE" data-participant-2="HW"><polygon fill="#107050" points="74.1909,150.9922,64.1909,154.9922,74.1909,158.9922,70.1909,154.9922" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="68.1909" x2="275.7773" y1="154.9922" y2="154.9922" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="80.1909" y="149.9263">03:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="162.2969" x="107.4805" y="149.9263">send issue VHL response</text></g></g></svg>
</figure>
<h4 id="trigger-events-1">Trigger Events</h4>
<ul>
  <li>The issue VHL request transaction is initiated when a privacy configuration form has been recorded by a <a href="system-actors.html#ochw">digital health wallet</a> that includes disclosure and time limit settings.
    <h4 id="message-semantics-1">Message Semantics</h4>
  </li>
</ul>

<h5 id="message-semantics-request-1">Message Semantics Request</h5>
<ul>
  <li>The message semantics for issue VHL Request shall include parameters that are required to construct a <a href="https://build.fhir.org/ig/HL7/smart-health-cards-and-links/links-specification.html#construct-a-smart-health-link-payload">SMART Health Link Payload</a>, specifically
    <ul>
      <li>flag for Passcode</li>
      <li>expiration time</li>
    </ul>
  </li>
</ul>

<h5 id="message-semantics-response-1">Message Semantics Response</h5>
<ul>
  <li>The issue VHL Request - Response shall include a serialized CWT via a QR Code Image as specified in the Expected Actions section.</li>
</ul>

<h4 id="expected-actions-1">Expected Actions</h4>
<p>The following are the expected actions for the <a href="system-actors.html#ochie">Origin Country HIE</a> once it receives the privacy configuration:</p>
<ul>
  <li>The Origin Country HIE creates a <a href="https://profiles.ihe.net/ITI/MHD/StructureDefinition-IHE.MHD.Minimal.Folder.html">Folder</a> for the pilgrim that includes the pilgrim's
    <ul>
      <li><mark>IPS document in FHIR or PDF or both</mark></li>
      <li>Signed IPS document as DSG jws JSON object for each document included in the folder</li>
    </ul>
  </li>
  <li>The <a href="https://build.fhir.org/ig/HL7/smart-health-cards-and-links/links-specification.html">SHL specifications</a>shall be followed to create a SMART Health Link which is then wrapped in <a href="https://www.smart.who.int/trust/StructureDefinition-Hcert.html">HCERT structure</a> and shared as a <a href="https://www.smart.who.int/trust/StructureDefinition-CWT.html">CWT structure</a>, by following the below steps:
    <ul>
      <li><b>Establish a location that points to the document references within the folder for the pilgrim in the following syntax: "{host}/List?_id={folder_id}&amp;_include=List:item" where 'folder_id' is a unique ID for the folder of health documents for the pilfrim. This shall be used as the Health Link URL within the VHL Payload</b></li>
      <li>Construct <a href="https://smart.who.int/trust/StructureDefinition-SmartHealthLinkPayload.html">SHLink Payload</a>
        <ul>
          <li>Minified</li>
          <li>Base64urlencoded</li>
          <li>Prefixed with shlink:/</li>
        </ul>
      </li>
      <li>Build HCERT containing SHL generated in previous step</li>
      <li>Build COSE Payload including the HCERT and sign with private key using Kid</li>
      <li>Build CWT with header payload and signature</li>
      <li>Serialize the CWT and using Base64</li>
      <li>Generate QR code</li>
    </ul>
  </li>
</ul>

<h3 id="retrieve-VHL-manifest-request">retrieve VHL folder docs - request</h3>

<p>The Retrieve VHL folder docs Request Event transaction is initiated by the <a href="system-actors.html#hcemr">Host Country EMR</a> against the Origin Country HIE.</p>

<figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="182px" preserveAspectRatio="none" style="width:433px;height:182px;" version="1.1" viewBox="0 0 433 182" width="433px" zoomAndPan="magnify"><defs /><g><g><title>Host Country</title><rect fill="#000000" fill-opacity="0.00000" height="78.2656" width="8" x="53.9717" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="57" x2="57" y1="52.5938" y2="130.8594" /></g><g><title>Origin Country</title><rect fill="#000000" fill-opacity="0.00000" height="78.2656" width="8" x="365.0835" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="368.8926" x2="368.8926" y1="52.5938" y2="130.8594" /></g><g class="participant participant-head" data-participant="HCEMR"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="105.9434" x="5" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="91.9434" x="12" y="24.9951">Host Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="30.6523" x="42.6455" y="41.292">EMR</text></g><g class="participant participant-tail" data-participant="HCEMR"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="105.9434" x="5" y="129.8594" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="91.9434" x="12" y="149.8545">Host Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="30.6523" x="42.6455" y="166.1514">EMR</text></g><g class="participant participant-head" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="310.8926" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="317.8926" y="24.9951">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="357.3325" y="41.292">HIE</text></g><g class="participant participant-tail" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="310.8926" y="129.8594" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="317.8926" y="149.8545">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="357.3325" y="166.1514">HIE</text></g><g class="message" data-participant-1="HCEMR" data-participant-2="OCHIE"><polygon fill="#107050" points="357.0835,79.7266,367.0835,83.7266,357.0835,87.7266,361.0835,83.7266" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="57.9717" x2="363.0835" y1="83.7266" y2="83.7266" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="64.9717" y="78.6606">01:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="216.1821" x="92.2612" y="78.6606">retrieve MHD folder docs request</text></g><g class="message" data-participant-1="OCHIE" data-participant-2="HCEMR"><polygon fill="#107050" points="68.9717,108.8594,58.9717,112.8594,68.9717,116.8594,64.9717,112.8594" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="62.9717" x2="368.0835" y1="112.8594" y2="112.8594" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="74.9717" y="107.7935">02:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="259.8223" x="102.2612" y="107.7935">send MHD folder docs request response</text></g></g></svg>
</figure>

<h4 id="trigger-events-2">Trigger Events</h4>
<ul>
  <li>The retrieve VHL folder docs request transaction is initiated when the host country EMR has extracted a VHL payload from a QR code that was scanned and the decrypted CWT decrypted yielded a HCERT payload that wrapped the VHL payload within it.</li>
</ul>

<h4 id="message-semantics-2">Message Semantics</h4>

<h5 id="message-semantics-request-2">Message Semantics Request</h5>
<ul>
  <li>The message semantics for retrieve VHL folder docs request shall be a POST request as specified by <a href="https://build.fhir.org/ig/HL7/smart-health-cards-and-links/links-specification.html#smart-health-link-manifest-request">SMART Health Link Manifest Request</a>, along with the passcode provided in the body of the request.</li>
</ul>

<h5 id="message-semantics-response-2">Message Semantics Response</h5>
<ul>
  <li>The message semantics shall follow a <b>modified</b> version of the <a href="https://profiles.ihe.net/ITI/MHD/ITI-67.html#2367422-message-semantics">ITI-67</a> Find Document References response message and for a successful queries return a FHIR bundle that includes all documentReference available in the VHL folder for the pilgrim.  The modification of the ITI-67 transaction is that the Origin Country HIE shall respect the <em>_include</em> search parameter with value <em>List:item</em> as the URL generated in the VHL Payload is of  of the format:
    <blockquote>
      <p>{host}/List?_id={folder_id}&amp;_include=List:item"</p>
    </blockquote>
  </li>
</ul>

<h4 id="expected-actions-2">Expected Actions</h4>
<ul>
  <li>The recipient OCHIE checks if the VHL request is valid and responds with the documentReference as a FHIR bundle Json.</li>
  <li>The recipient OCHIE acts as a VHL Document Responder and must conform with the capability statement for <a href="CapabilityStatement-VHLDocumentResponder.html">VHL Document Responder</a></li>
</ul>

<h3 id="retrieve-IPS-request">retrieve IPS - request</h3>

<p>The Retrieve IPS Request Event transaction is initiated by the <a href="system-actors.html#hcemr">Host Country EMR</a> against the Origin Country HIE.</p>

<figure>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="182px" preserveAspectRatio="none" style="width:346px;height:182px;" version="1.1" viewBox="0 0 346 182" width="346px" zoomAndPan="magnify"><defs /><g><g><title>Host Country</title><rect fill="#000000" fill-opacity="0.00000" height="78.2656" width="8" x="53.9717" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="57" x2="57" y1="52.5938" y2="130.8594" /></g><g><title>Origin Country</title><rect fill="#000000" fill-opacity="0.00000" height="78.2656" width="8" x="277.8794" y="52.5938" /><line style="stroke:#107050;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="281.6885" x2="281.6885" y1="52.5938" y2="130.8594" /></g><g class="participant participant-head" data-participant="HCEMR"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="105.9434" x="5" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="91.9434" x="12" y="24.9951">Host Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="30.6523" x="42.6455" y="41.292">EMR</text></g><g class="participant participant-tail" data-participant="HCEMR"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="105.9434" x="5" y="129.8594" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="91.9434" x="12" y="149.8545">Host Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="30.6523" x="42.6455" y="166.1514">EMR</text></g><g class="participant participant-head" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="223.6885" y="5" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="230.6885" y="24.9951">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="270.1284" y="41.292">HIE</text></g><g class="participant participant-tail" data-participant="OCHIE"><rect fill="#FFFFFF" height="46.5938" rx="4.5" ry="4.5" style="stroke:#107050;stroke-width:0.5;" width="116.3818" x="223.6885" y="129.8594" /><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="102.3818" x="230.6885" y="149.8545">Origin Country</text><text fill="#000000" font-family="Roboto Condensed" font-size="14" lengthAdjust="spacing" textLength="23.502" x="270.1284" y="166.1514">HIE</text></g><g class="message" data-participant-1="HCEMR" data-participant-2="OCHIE"><polygon fill="#107050" points="269.8794,79.7266,279.8794,83.7266,269.8794,87.7266,273.8794,83.7266" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="57.9717" x2="275.8794" y1="83.7266" y2="83.7266" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="64.9717" y="78.6606">01:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="128.978" x="92.2612" y="78.6606">retrieve IPS request</text></g><g class="message" data-participant-1="OCHIE" data-participant-2="HCEMR"><polygon fill="#107050" points="68.9717,108.8594,58.9717,112.8594,68.9717,116.8594,64.9717,112.8594" style="stroke:#107050;stroke-width:1;" /><line style="stroke:#107050;stroke-width:1;" x1="62.9717" x2="280.8794" y1="112.8594" y2="112.8594" /><text fill="#000000" font-family="Roboto Condensed" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23.2896" x="74.9717" y="107.7935">02:</text><text fill="#000000" font-family="Roboto Condensed" font-size="13" lengthAdjust="spacing" textLength="172.6182" x="102.2612" y="107.7935">send IPS request response</text></g></g></svg>
</figure>
<h4 id="trigger-events-3">Trigger Events</h4>
<ul>
  <li>The retrieve IPS request transaction is initiated when the host country EMR has extracted the bundle of documentReference from within the VHL folder and is now requesting for retrieving the IPS in JSON format.</li>
</ul>

<h4 id="message-semantics-3">Message Semantics</h4>

<h5 id="message-semantics-request-3">Message Semantics Request</h5>
<ul>
  <li>The message semantics for retrieve IPS Request shall be a GET request for the IPS json.
    <ul>
      <li>The Host Country EMR shall act as a Document Consumer and follow <a href="https://profiles.ihe.net/ITI/MHD/ITI-68.html">ITI-68</a>.</li>
    </ul>
  </li>
</ul>

<h5 id="message-semantics-response-3">Message Semantics Response</h5>
<ul>
  <li>The message semantics for retrieve IPS Request-response shall send the IPS as a Json file.</li>
</ul>

<h4 id="expected-actions-3">Expected Actions</h4>
<ul>
  <li>The recipient OCHIE responds with the IPS Json.</li>
</ul>




</div>
</div>  <!-- /inner-wrapper -->
</div>  <!-- /row -->
</div>  <!-- /container -->
</div>  <!-- /segment-content -->

<script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
<script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

<script type="text/javascript" src="assets/js/window-hash.js"> </script>
<a name="bottom"> </a>
<div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
<div class="container">  <!-- container -->

<div class="inner-wrapper">
  <p>
    IG &#169; 2023+ <a style="color:var(--footer-hyperlink-text-color)" href="http://who.int">WHO</a>.  Package smart.who.int.ips-pilgrimage#2.0.3 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Tue, May 27, 2025 10:59+0000">2025-05-27</span>
    <br/>
    <span style="color: var(--footer-highlight-text-color)">
                Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
| <a style="color: #81BEF7" target="_blank" href="http://smart.who.int/ips-pilgrimage/history.html">Version History</a> | <a style="color: #81BEF7" rel="license" href="license.html">License</a>
    </span>
  </p>
</div>  <!-- /inner-wrapper -->
</div>  <!-- /container -->
</div>  <!-- /segment-footer -->

<div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
<div class="container">  <!-- container -->
</div>  <!-- /container -->
</div>  <!-- /segment-post-footer -->

<!-- JS and analytics only. -->
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
<script type="text/javascript" src="assets/js/respond.min.js"> </script>
<script type="text/javascript" src="assets/js/anchor.min.js"> </script>
<script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
<script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
<script type="text/javascript" src="assets/js/anchor-hover.js"> </script>
<!-- Analytics Below
================================================== -->




