<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1" localId="0">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="Overloads" xsi:type="a:CqlToElmInfo"/>
   <annotation message="An operand identifier [reference] is hiding another identifier of the same name." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="An operand identifier [reference] is hiding another identifier of the same name." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="An operand identifier [reference] is hiding another identifier of the same name." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="258">
         <a:s>/**
 * Library: HIV.IND.93 Logic
 * Ref No: CCA.1
 * Short Name: Cervical cancer screening
 *
 * Definition: Number of women living with HIV who were screened for cervical cancer using any screening test
 *
 * Numerator: Number of women living with HIV who were screened for cervical cancer using any screening test (HPV DNA test, visual inspection with acetic acid, cytology, other)
 * Numerator Calculation: COUNT of women with &quot;HIV status&quot;='HIV-positive' AND with a &quot;Date of cervical cancer screening test&quot; in the reporting period
 * Numerator Exclusions: 
 *
 * Denominator: 1
 * Denominator Calculation: 1
 * Denominator Exclusions: 
 *
 * Disaggregations:
 * • Age (15–19, 20–24, 25–29, 30–49, 50+ years) 
 *  • Lifetime screening test number (First in lifetime, second in lifetime, etc.) 
 *  • Cities and other administrative areas of epidemiologic importance
 *
 * Disaggregation Elements: Age | Lifetime screening test number
 *
 * Numerator and Denominator Elements:
 * Date of cervical cancer screening test 
 *  HIV status
 *
 * Reference: Consolidated guidelines on person-centred HIV strategic information: strengthening routine data for impact. Geneva: World Health Organization; 2022
 * 
 * Data Concepts:
 * HIV.A.DE17: Age | Calculated age (number of years) of the client based on date of birth
 * HIV.B.DE115: HIV status | HIV status reported after applying the national HIV testing algorithm. No single HIV test can provide an HIV-positive diagnosis.
 * HIV.B.DE116: HIV-positive | Client is HIV-positive
 * HIV.B.DE117: HIV-negative | Client is HIV-negative
 * HIV.B.DE118: Unknown | Client has unknown HIV status
 * HIV.D.DE656: Date of cervical cancer screening test | Date of cervical cancer screening test
 * HIV.D.DE657: Lifetime screening test number | Client's lifetime number of screenings for cervical cancer
 *
 * Additional Context
 * - what it measures: Progress towards scaling up population-based screening for the prevention of cervical cancer among women living with HIV.
 * - rationale: To measure progress towards scaling up screening for the prevention of cervical cancer among women living with HIV. Since the screening interval between tests depends on the test used, the number of women screened may vary from year to year.
 * - method: Health facility patient registers, patient records |  | The number is generated by counting the number of women living with HIV among all women who were screened for cervical cancer in the last 12 months, using health facility patient registers or patient records as the source. |  | Each individual should be counted only once in the reporting period. If a second triage test or a follow-up test was performed as part of the screening strategy, that individual should be counted only once.
 * 
 * Suggested Scoring Method: continuous-variable | http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cv-measure-cqfm
 */

 /* 
  * Profiles:
  * - HIVStatusCondition
  * - HIVStatusObservation
  * - HivCervicalCancerScreening
  */
  
library HIVIND93Logic</a:s>
      </a:s>
   </annotation>
   <identifier id="HIVIND93Logic" system="http://smart.who.int/hiv"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localId="1" localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="206" locator="56:1-56:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="206">
               <a:s>// Included Libraries
using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="207" locator="58:1-58:44" localIdentifier="HIC" path="http://smart.who.int/hiv/HIVCommon" version="0.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="207">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVCommon</a:s>
               </a:s>
               <a:s> version '0.0.1' called HIC</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="208" locator="59:1-59:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="208">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="209" locator="61:1-61:29" localIdentifier="WCom" path="http://smart.who.int/hiv/WHOCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="209">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOCommon</a:s>
               </a:s>
               <a:s> called WCom</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="210" locator="62:1-62:29" localIdentifier="HE" path="http://smart.who.int/hiv/HIVElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="210">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVElements</a:s>
               </a:s>
               <a:s> called HE</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="211" locator="63:1-63:39" localIdentifier="HIE" path="http://smart.who.int/hiv/HIVIndicatorElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="211">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVIndicatorElements</a:s>
               </a:s>
               <a:s> called HIE</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="212" locator="64:1-64:31" localIdentifier="Config" path="http://smart.who.int/hiv/HIVConfig">
         <annotation xsi:type="a:Annotation">
            <a:s r="212">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVConfig</a:s>
               </a:s>
               <a:s> called Config</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="213" locator="67:1-67:88" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="213">
               <a:s>// Indicator Definition
parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="225">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="226">
                     <a:s>Date</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="224">
                  <a:s r="218">Interval[@2023-01-01, @2023-01-30]</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="224" locator="67:55-67:88" lowClosed="true" highClosed="true" xsi:type="Interval">
            <low localId="218" locator="67:64-67:74" xsi:type="Date">
               <year localId="215" valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month localId="216" valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day localId="217" valueType="t:Integer" value="1" xsi:type="Literal"/>
            </low>
            <high localId="223" locator="67:77-67:87" xsi:type="Date">
               <year localId="220" valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month localId="221" valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day localId="222" valueType="t:Integer" value="30" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="225" locator="67:32-67:45" xsi:type="IntervalTypeSpecifier">
            <pointType localId="226" locator="67:41-67:44" name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <contexts>
      <def localId="230" locator="69:1-69:15" name="Patient"/>
   </contexts>
   <statements>
      <def localId="228" locator="69:1-69:15" name="Patient" context="Patient">
         <expression localId="229" xsi:type="SingletonFrom">
            <operand localId="227" locator="69:1-69:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="232" locator="76:1-77:6" name="Initial Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="232">
               <a:s r="233">/* Populations */

/*
 *Initial Population
 */

define &quot;Initial Population&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="233" locator="77:3-77:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="235" locator="86:1-87:80" name="Measure Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="235">
               <a:s>/**
 * Measure Population
 *
 * Definition: Number of women living with HIV who were screened for cervical cancer using any screening test (HPV DNA test, visual inspection with acetic acid, cytology, other)
 * Calculation: Number of women living with HIV who were screened for cervical cancer using any screening test (HPV DNA test, visual inspection with acetic acid, cytology, other)
 */
                                                       
define &quot;Measure Population&quot;:
  </a:s>
               <a:s r="236">
                  <a:s r="238">
                     <a:s r="237">
                        <a:s>HIE</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="238">
                        <a:s>&quot;Has HIV-positive Status&quot;</a:s>
                     </a:s>
                  </a:s>
                  <a:s> and </a:s>
                  <a:s r="240">
                     <a:s r="239">
                        <a:s>HIE</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="240">
                        <a:s>&quot;Date of cervical cancer screening test&quot;</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="236" locator="87:3-87:80" xsi:type="And">
            <operand localId="238" locator="87:3-87:31" name="Has HIV-positive Status" libraryName="HIE" xsi:type="ExpressionRef"/>
            <operand localId="240" locator="87:37-87:80" name="Date of cervical cancer screening test" libraryName="HIE" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="241" locator="96:1-97:3" name="Measure Observation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="241">
               <a:s>/**
 * Measure Observation
 * Definition: Number of women living with HIV who were screened for cervical cancer using any screening test (HPV DNA test, visual inspection with acetic acid, cytology, other)
 * Calculation: Number of women living with HIV who were screened for cervical cancer using any screening test (HPV DNA test, visual inspection with acetic acid, cytology, other)                                                      
 */     

define function &quot;Measure Observation&quot;(Patient &quot;Patient&quot;):
  </a:s>
               <a:s r="244">
                  <a:s r="244">1</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="244" locator="97:3" valueType="t:Integer" value="1" xsi:type="Literal"/>
         <operand localId="243" name="Patient">
            <operandTypeSpecifier localId="242" locator="96:47-96:55" name="fhir:Patient" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="246" locator="104:1-105:26" name="Age Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="246">
               <a:s>/* end Populations */

/*
 * Disaggregators
 */

define &quot;Age Stratifier&quot;:
	</a:s>
               <a:s r="248">
                  <a:s r="247">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="248">
                     <a:s>&quot;By Age Stratifier 9&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="248" locator="105:2-105:26" name="By Age Stratifier 9" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="250" locator="107:1-108:38" name="Geographic Region Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="250">
               <a:s>define &quot;Geographic Region Stratifier&quot;:
	</a:s>
               <a:s r="252">
                  <a:s r="251">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="252">
                     <a:s>&quot;By Geographic Region Stratifier&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="252" locator="108:2-108:38" name="By Geographic Region Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="254" locator="110:1-111:44" name="Lifetime screening test number Statifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="254">
               <a:s>define &quot;Lifetime screening test number Statifier&quot;:
  </a:s>
               <a:s r="256">
                  <a:s r="255">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="256">
                     <a:s>&quot;Lifetime screening test number Value&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="256" locator="111:3-111:44" name="Lifetime screening test number Value" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="258" locator="114:1-117:52" name="Stratification" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="258">
               <a:s>define &quot;Stratification&quot;:
</a:s>
               <a:s r="286">
                  <a:s r="279">
                     <a:s r="275">
                        <a:s r="268">
                           <a:s r="264">
                              <a:s r="263">
                                 <a:s>HIE</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="264">
                                 <a:s>&quot;By Age Stratifier 9&quot;</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
+ </a:s>
                           <a:s r="265">
                              <a:s>':'</a:s>
                           </a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="270">
                           <a:s r="269">
                              <a:s>HIE</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="270">
                              <a:s>&quot;By Geographic Region Stratifier&quot;</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
+ </a:s>
                     <a:s r="276">
                        <a:s>':'</a:s>
                     </a:s>
                  </a:s>
                  <a:s> + </a:s>
                  <a:s r="281">
                     <a:s>(</a:s>
                     <a:s r="281">
                        <a:s r="280">
                           <a:s>HIE</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="281">
                           <a:s>&quot;Lifetime screening test number Value&quot;</a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="286" locator="115:1-117:52" xsi:type="Concatenate">
            <operand localId="279" locator="115:1-117:5" xsi:type="Concatenate">
               <operand localId="275" locator="115:1-116:45" xsi:type="Concatenate">
                  <operand localId="268" locator="115:1-116:5" xsi:type="Concatenate">
                     <operand localId="264" locator="115:1-115:25" name="By Age Stratifier 9" libraryName="HIE" xsi:type="ExpressionRef"/>
                     <operand localId="265" locator="116:3-116:5" valueType="t:String" value=":" xsi:type="Literal"/>
                  </operand>
                  <operand localId="271" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature localId="272" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="270" locator="116:9-116:45" name="By Geographic Region Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
                  </operand>
               </operand>
               <operand localId="276" locator="117:3-117:5" valueType="t:String" value=":" xsi:type="Literal"/>
            </operand>
            <operand localId="282" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <signature localId="283" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
               <operand localId="281" locator="117:9-117:52" name="Lifetime screening test number Value" libraryName="HIE" xsi:type="ExpressionRef"/>
            </operand>
         </expression>
      </def>
   </statements>
</library>
